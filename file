import snowflake.connector
import os
from dotenv import load_dotenv

# Load environment variables
load_dotenv()

try:
    conn = snowflake.connector.connect(
        account=os.getenv("URL_SF").split("//")[-1].split(".snowflakecomputing.com")[0],
        user=os.getenv("USER_SDL_SF"),
        private_key_file=os.path.join(os.getenv("DATA_ROOT"), os.getenv("KEYTAB_FILE_SDL_SF")),
        private_key_file_pwd=os.getenv("PASSWORD_SDL_SF"),
        database=os.getenv("DB_SDL_SF"),
        schema=os.getenv("SCHEMA_SDL_SF"),
        warehouse=os.getenv("WAREHOUSE_SDL_SF"),
        role=os.getenv("ROLE_SDL_SF"),
        authenticator='SNOWFLAKE_JWT'
    )

    print("‚úÖ Successfully connected to Snowflake!")

    with conn.cursor() as cursor:
        cursor.execute("SELECT current_version()")
        version = cursor.fetchone()
        print(f"üßä Snowflake version: {version[0]}")

    conn.close()
    print("üîí Connection closed.")

except Exception as e:
    print(f"‚ùå Error connecting to Snowflake: {e}")