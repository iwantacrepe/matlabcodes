import snowflake.connector
from cryptography.hazmat.primitives import serialization
from dotenv import load_dotenv
import os

load_dotenv()

user = os.getenv("SNOWFLAKE_USER")
account = os.getenv("SNOWFLAKE_ACCOUNT")
warehouse = os.getenv("SNOWFLAKE_WAREHOUSE")
database = os.getenv("SNOWFLAKE_DATABASE")
schema = os.getenv("SNOWFLAKE_SCHEMA")
role = os.getenv("SNOWFLAKE_ROLE")

# ✅ Load private key from .p8 file
with open("private_key.p8", "rb") as key_file:
    private_key = serialization.load_pem_private_key(
        key_file.read(),
        password=None,
    )

# ✅ Connect using key-pair
conn = snowflake.connector.connect(
    user=user,
    account=account,
    private_key=private_key,
    warehouse=warehouse,
    database=database,
    schema=schema,
    role=role
)

cursor = conn.cursor()
cursor.execute("SELECT CURRENT_USER(), CURRENT_ROLE()")
print(cursor.fetchall())

cursor.close()
conn.close()