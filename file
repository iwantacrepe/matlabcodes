import jaydebeapi
from dotenv import load_dotenv
import os

# Load environment variables
load_dotenv()

# Fetch values
user = os.getenv("SNOWFLAKE_USER")
password = os.getenv("SNOWFLAKE_PASSWORD")
account = os.getenv("SNOWFLAKE_ACCOUNT")
warehouse = os.getenv("SNOWFLAKE_WAREHOUSE")
database = os.getenv("SNOWFLAKE_DATABASE")
schema = os.getenv("SNOWFLAKE_SCHEMA")
role = os.getenv("SNOWFLAKE_ROLE")

# JDBC connection string
jdbc_url = (
    f"jdbc:snowflake://{account}.snowflakecomputing.com/?"
    f"warehouse={warehouse}&db={database}&schema={schema}&role={role}"
)

# Path to your downloaded Snowflake JDBC jar
jdbc_driver_path = "snowflake-jdbc-3.13.25.jar"
jdbc_driver_class = "net.snowflake.client.jdbc.SnowflakeDriver"

# Connect using JayDeBeApi
try:
    conn = jaydebeapi.connect(
        jclassname=jdbc_driver_class,
        url=jdbc_url,
        driver_args=[user, password],
        jars=jdbc_driver_path
    )

    cursor = conn.cursor()
    cursor.execute("SELECT CURRENT_USER(), CURRENT_DATABASE(), CURRENT_SCHEMA()")
    results = cursor.fetchall()

    for row in results:
        print(row)

    cursor.close()
    conn.close()

except Exception as e:
    print("‚ùå JDBC Snowflake connection failed:", e)